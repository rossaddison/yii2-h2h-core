**Installation Steps for Files:**

1. **Clone** or **unzip** the folders into your C:\wamp64\www\my_folder_name\web  directory making sure that your composer.json is in the web folder ie. C:\wamp64\www\my_folder_name\web\composer.json. Composer will create the vendor folder for you if it does not exist.
1. Install Composer from **composer.org** 
1. On your local desktop using CLI (Command Line Interface) or windows command prompt, change your directory to C:\wamp64\www\yours\web which is where your composer.json and the vendor folder is located.
1. Run the following command from the command prompt: composer update. 

       C:\wamp64\www\<my_folder_name>\web>composer update

This will install the dependencies that are under 'require' under composer.json into the vendor folder.
1. Make sure that your frontend/config/main.php is properly configured especially the mailer component so that you can register your first user which will inherit admin rights. Ensure that libra - fencemode is off to be able to register.
1. Make sure that your frontend/modules/subscriptions/components/configpaypal.php is properly configured when you opt to use subscriptions although by default this will be ignored as long as you keep the **Subscription Free Privilege permission** assigned to the respective Udb role or Mdb role relevant to the database or, if you elect not to have it linked to these roles, the higher 'more universal' roles of 'employee' and 'support' respectively.
1. Upload these folders to the web/public-html folder using ftp (File Transfer Protocol) upload software eg. **filezilla** to your host eg. one.com, godaddy.com
1. Ensure that your databases on your host correspond to the number of databases in the four files mentioned below i,ii,iii,iv.  [Back](/md/faq/faqs.md)

**Installation Steps for admin database - 'db' ie. not subsequent manager databases 'db1','db2'** 

1. Create and Name your **databases** manually through phpMyadmin on your WAMP or LAMP **matching** the details in **common/config/main-local.php.** You will rename your databases in this main-local.php file according to the autogenerated schema given to you by your host most likely and so will have to change it from the default h2h_db as mentioned in the **common**/config/main-local.php **to** eg. your_domain_co_uk_db.  [Back](/md/faq/faqs.md)

1. **Check your 'path' environment settings, under Windows 10:**

       Search...Environment Settings...Advanced...Environment Variables...User variables...PATH...edit, for 'path'.
   
1. **Install the sjaakp/pluto migration, frontend/migrations, paypal module migration, and auth migration with the following command at your command prompt:** 
   
       php yii migrate-db-namespaced  (linux eg. putty) 
       yii migrate-db-namespaced      (if a defined php path eg. c:\wamp64\bin\php\php7.4.4 in *environment settings* under windows)
       
Regarding the above Yii migrate command, it will look at the db component contained in **common**/config/main-local.php and install the migrations to the  named database eg. **h2h_db** on your **localhost** or to **your_domain_co_uk_db** on your **host** using the commands which have been constructed in the **ControllerMap** in **console**/config/main.php eg. the command  **'migrate-db-namespaced'.**

This command will use the migration paths contained in **console**/config/main.php. There are currently 4 paths sjaakp/pluto,   frontend/migrations, paypal, and auth. Although the migration generator Gii created these migrations from tables, they have been namespaced ("pathed") ie. the word **Namespace** has been manually inserted at the top of the migration file generated and placed in the relevant folder on that **path/namespace** after Gii generated the migration file from the developer's table.  [Back](/md/faq/faqs.md)

**Installation Steps for subsequent manager databases 'db1','db2' and not admin database 'db'** 

1. Linux via eg. Putty for your **subsequent** databases: 

       php yii migrate-db1
       
1. If on your localhost on windows: 

       yii migrate-db1

1. Repeat this process up until the 10th database if you intend to share your site to up to 10 companies. As you have probably noticed all 10 commands are contained in **console**/config/main.php under the controllerMap.  [Back](/md/faq/faqs.md)

**Installation Steps if wanting more than 10 independent sharers.** 

1. If you have more than 10 companies/divisions/units that you as administrator are wanting to signup you will need to edit the following three files:

    1. *frontend/**components**/Utilities::userLogin_set_database(). Include additional databases here using the naming convention eg. db1, db2*
    1. ***common**/config/main-local.php - Follow the naming convention eg. db1, db2*
    1. ***console**/config/main.php - edit and replicate the commands in the **controllerMap** for migrations over and above the 10 databases.*

1. In order to sign up your first user, you will have to make sure that **'fencemode'** is switched off. The fencemode setting under frontend/config/main.php can be set to a **boolean** or to a **string**. It is currently set to a string. By default the Fence Mode role has not been assigned the **'User can Login but not Signup - Fence Mode On'** permission. So the first guest can signup and acquire the admin role.   [Back](/md/faq/faqs.md)

**frontend/config/main.php**

    'modules' => [
      'libra' => [
        'class' => 'sjaakp\pluto\Module',
        'fenceMode' => true,
        
1. Ensure that your mailer component under frontend\config\main.php is correctly set so that your user can respond to your email. Testing on your **localhost** and wampserver, the port will normally be **port 25** since you will be going through your service provider, such as BT.  [Back](/md/faq/faqs.md)
 
 **Troubleshooting**
 
 Besides the issues section for this repository, in order to debug your code, defaults have been set in the following files:
    web/index.php
    
    defined('YII_DEBUG') or define('YII_DEBUG', true);
    defined('YII_ENV') or define('YII_ENV', 'dev');
    
On completion ensure the following:

    defined('YII_DEBUG') or define('YII_DEBUG', false);
    defined('YII_ENV') or define('YII_ENV', 'prod');

**Creating migration files on your local machine so that you can use the 'migrate' command in future. You will use pre-existing auth tables that you installed by means of the sql files. (If you want to install the auth tables using 'migrate' skip this section.**)

Occasionally you will need to create migration files in order to simplify a process instead of importing a **sql** file such as the included console/migrations/**auth**/auth.sql or running sql commands from the phpMyadmin SQL section. 

For instance create migrations for: 

    auth_assignment - the critical assignment of a user_id from the user table to a pre-built role. After the user table is filled after signup, this table will be filled second after the installation automatically with first user_id and the admin role.

    auth_item - permissions
    auth_item_child - roles with permissions
    auth_rule - conditions
    
 Under frontend/config/main-local.php the following default code is present:
 
    if (YII_DEBUG) {
    // configuration adjustments for 'dev' environment
    $config['bootstrap'][] = 'debug';
    $config['modules']['debug'] = [
        'class' => 'yii\debug\Module',
        'allowedIPs' =>['127.0.0.1'],
    ];

    $config['bootstrap'][] = 'gii';
    $config['modules']['gii'] = [
        'class' => 'yii\gii\Module',
        'allowedIPs' =>['127.0.0.1'],
    ];
    }

Keep the localhost ip address [127.0.0.1]. Run the following command from your browser assuming you have setup your wampserver:

    mylocalhostname.myhost/gii/

Assuming that you have already run the **auth.sql** under your phpAdmin, you should already have the auth tables in your database so select them and generate your migration. 

Make sure that you put the **Namespace** command at the top of each migration php file once the migration is completed. After you have put this migration in the console/migrations/auth folder if necessary alter the controllerMap.  

**Installation of roles and permissions by migrations**

To install the above auth tables through a migration instead of through the auth.sql file, the namespace or path has now been included in the  **console/config/main.php's controllerMap** command **migrate-db-namespaced**. So if you have run this command already, the auth tables will already be setup with all the roles and permissions. The auth migrations necessary for filling the rbac auth tables are in:

    console/migrations/auth

**Why are the auth tables important?** 

They are the soul of RBAC (Role Based Access Control). After the administrator has given the user a role eg. mdb2 for manager, the auth_assignment table indicates the admin's decision that has occurred between the user table and the auth_item a.k.a permissions table with its buddy the auth_item_child table or 'role and permissions table' and the result ... in the auth_assignment table is a lonely user_id digit (that has so much significance in his home town the 'user table') with its companion and close associate, a simple role with all its potential. 

So the **yii migrate-db-namespaced** command will create a bare-bones auth_assignment table, desperately hungry to track admin decisions, and a powerful duo, the auth_item and auth_item_child, policing partners, ready to flex their roles and administer 'allowed to' and 'denied' permissions. The auth_rule table is for finer conditions. This command also creates the sjaakp/pluto user table and the works tables, and also the paypal tables which, although not possibly used, are important for the package to run.  [Back](/md/faq/faqs.md)

 **Installing roles and permissions using SQL on your localhost/host**
 
Whilst in the db database, copy the sql  commands in console/migrations/auth and run them in your phpMyadmin SQL section. 

**Allowing a manager to do their own 'Works' installation**

All managers with Mdb roles can do their own migration of the frontend database if you give them the **Migrate Works Database** permission. This permission is linked to the installer module and can be accessed by typing 'installer/installer' in the browser. By default nobody has this permission for security reasons. The administrator will have to access individual databases one at a time in order to use the installer. The administrator will not need it for database 'db' because installation would have been done by the console/command prompt/putty etc in order to get the RBAC GUI running the migrate-db-namespaced command. So the installer is intended for managers and not administrators so that they can install their own databases.   [Back](/md/faq/faqs.md)

**Allowing a manager to do their own 'Works' backup**

The Works tables are all those tables given to managers of each individual database. Managers do not have access to database db. All managers with Mdb roles can do their own backup of their separate frontend database/division/unit eg. db1 if you give the **Backup database** permission to the eg. Mdb1 role for the Manager of db1.  The backup module can be accessed by typing 'backuper/backuper' in the browser or by clicking on the Backup Database button. Only those who inherit the 'admin' or 'support' role will have access to the software via the controller and the frontend/views/layouts/main.php.  [Back](/md/faq/faqs.md)

The **admin** will have to give the **'Backup Database'** permission to the **role** admin in order to backup their mySql db database.

The backup module makes use of the **very popular ifsnop mySql** module. See https://packagist.org/packages/ifsnop/mysqldump-php.
